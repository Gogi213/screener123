# üöÄ Sprint 2: Frontend Migration to gRPC-Web

## –ó–∞–¥–∞—á–∞ 1: –ó–∞–º–µ–Ω–∞ WebSocket –Ω–∞ gRPC Client
**–§–∞–π–ª:** `screener.js`  
**–°—Ç—Ä–æ–∫–∏:** ~20-50  
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- [ ] –£–¥–∞–ª–∏—Ç—å `new WebSocket(...)` –∏ –≤–µ—Å—å WebSocket –∫–æ–¥
- [ ] –£–¥–∞–ª–∏—Ç—å `websocket-worker.js` (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
- [ ] –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä `GrpcTradeClient`
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `ws.onopen` –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é gRPC
- [ ] –£–¥–∞–ª–∏—Ç—å `ws.onmessage`, `ws.onerror`, `ws.onclose`

**–°—Ç–∞—Ä—ã–π –∫–æ–¥ (—É–¥–∞–ª–∏—Ç—å):**
```javascript
const ws = new WebSocket('ws://localhost:8181');
const worker = new Worker('js/websocket-worker.js');
```

**–ù–æ–≤—ã–π –∫–æ–¥:**
```javascript
const grpcClient = new GrpcTradeClient('http://localhost:5000');
```

---

## –ó–∞–¥–∞—á–∞ 2: –£–±—Ä–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
**–§–∞–π–ª:** `screener.js`  
**–°—Ç—Ä–æ–∫–∏:** ~200-250, ~380-420  
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- [ ] –£–¥–∞–ª–∏—Ç—å `symbolActivity` Map (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç!)
- [ ] –£–¥–∞–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `reorderCardsWithoutDestroy()`
- [ ] –£–¥–∞–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `updateSymbolActivity()`
- [ ] –£–¥–∞–ª–∏—Ç—å –∫–æ–¥ –ø–æ–¥—Å—á—ë—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- [ ] –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã `reorderCardsWithoutDestroy()`

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**  
–°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–º–≤–æ–ª—ã –£–ñ–ï –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ `tradesPerMin`. –ö–ª–∏–µ–Ω—Ç—É –Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ —Å—á–∏—Ç–∞—Ç—å!

---

## –ó–∞–¥–∞—á–∞ 3: –ü–æ–¥–∫–ª—é—á–∏—Ç—å gRPC streaming
**–§–∞–π–ª:** `screener.js`  
**–°—Ç—Ä–æ–∫–∏:** ~50-100  
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- [ ] –í—ã–∑–≤–∞—Ç—å `grpcClient.streamTrades(currentPage, 100, onTradeUpdate, onError)`
- [ ] –í `onTradeUpdate(tradeUpdate)` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ trades
- [ ] –£–±—Ä–∞—Ç—å batching –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (—Å–µ—Ä–≤–µ—Ä —É–∂–µ –±–∞—Ç—á–∏—Ç –∫–∞–∂–¥—ã–µ 100ms)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ gRPC

**–ù–æ–≤—ã–π –∫–æ–¥:**
```javascript
grpcClient.streamTrades(currentPage, 100, (tradeUpdate) => {
    // tradeUpdate = { symbol: "MEXC_BTCUSDT", trades: [...] }
    updateChart(tradeUpdate.symbol, tradeUpdate.trades);
}, (error) => {
    console.error('[gRPC] Stream error:', error);
    updateStatus('‚ö†Ô∏è Disconnected', 'error');
});
```

---

## –ó–∞–¥–∞—á–∞ 4: –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
**–§–∞–π–ª:** `screener.js`  
**–°—Ç—Ä–æ–∫–∏:** ~100-180  
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- [ ] –£–±—Ä–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `symbols_metadata` (–Ω–µ –Ω—É–∂–Ω–æ, gRPC streaming —Å—Ä–∞–∑—É –¥–∞—ë—Ç trades)
- [ ] –£–±—Ä–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `page_data` (–Ω–µ –Ω—É–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º streaming)
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å `updateChart()` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç TradeUpdate –Ω–∞–ø—Ä—è–º—É—é
- [ ] –£–±—Ä–∞—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ (gRPC —É–∂–µ –¥–∞—ë—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

---

## –ó–∞–¥–∞—á–∞ 5: –û–±–Ω–æ–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
**–§–∞–π–ª:** `screener.js`  
**–°—Ç—Ä–æ–∫–∏:** ~300-350  
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- [ ] –ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π gRPC stream
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π stream –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- [ ] –û—á–∏—Å—Ç–∏—Ç—å grid –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `currentPage` –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

**–ù–æ–≤—ã–π –∫–æ–¥:**
```javascript
function changePage(delta) {
    // Stop current stream
    if (currentStream) {
        currentStream.abort();
    }
    
    currentPage += delta;
    
    // Clear grid
    grid.innerHTML = '';
    allCards.clear();
    
    // Start new stream for new page
    connectGrpcStream();
}
```

---

## –ó–∞–¥–∞—á–∞ 6: –£–±—Ä–∞—Ç—å Smart Sort toggle (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
**–§–∞–π–ª:** `screener.js`  
**–°—Ç—Ä–æ–∫–∏:** ~350-370  
**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- [ ] –£–±—Ä–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `toggleSmartSort()` (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –í–°–ï–ì–î–ê —Å–µ—Ä–≤–µ—Ä–Ω–∞—è!)
- [ ] –ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –Ω–æ —Å–¥–µ–ª–∞—Ç—å –µ—ë –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π ("Server-Side Sort: ON")

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**  
–° gRPC —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –í–°–ï–ì–î–ê –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ù–µ—Ç —Å–º—ã—Å–ª–∞ –≤ toggle.

---

## –ó–∞–¥–∞—á–∞ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü)
- [ ] –°–∏–º–≤–æ–ª—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ (–∑–∞–∫—Ä—ã–≤–∞–µ–º streams –ø—Ä–∏ unmount)
- [ ] –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- [ ] Performance: –æ—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Network ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç ~100 —Å–∏–º–≤–æ–ª–æ–≤ –≤–º–µ—Å—Ç–æ 2112

---

## –ó–∞–¥–∞—á–∞ 8: –û—á–∏—Å—Ç–∫–∞ –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- [ ] –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª `websocket-worker.js` (–±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] –£–±—Ä–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ "gRPC-Web" –≥–¥–µ –Ω—É–∂–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ TODO –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**–î–æ (WebSocket + JSON):**
- ‚ùå 2112 —Å–∏–º–≤–æ–ª–æ–≤ –∫–∞–∂–¥—ã–µ 100ms
- ‚ùå –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (CPU load)
- ‚ùå JSON –ø–∞—Ä—Å–∏–Ω–≥ (–º–µ–¥–ª–µ–Ω–Ω–æ)
- ‚ùå 500+ KB/s —Ç—Ä–∞—Ñ–∏–∫

**–ü–æ—Å–ª–µ (gRPC-Web + Protobuf):**
- ‚úÖ 100 —Å–∏–º–≤–æ–ª–æ–≤ –∫–∞–∂–¥—ã–µ 100ms (21x –º–µ–Ω—å—à–µ!)
- ‚úÖ –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (0 CPU –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
- ‚úÖ Protobuf –ø–∞—Ä—Å–∏–Ω–≥ (15x –±—ã—Å—Ç—Ä–µ–µ)
- ‚úÖ ~25 KB/s —Ç—Ä–∞—Ñ–∏–∫ (20x –º–µ–Ω—å—à–µ!)

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

1. **–ó–∞–¥–∞—á–∞ 1** - –∫—Ä–∏—Ç–∏—á–Ω–æ (–±–µ–∑ —ç—Ç–æ–≥–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
2. **–ó–∞–¥–∞—á–∞ 3** - –∫—Ä–∏—Ç–∏—á–Ω–æ (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ gRPC stream)
3. **–ó–∞–¥–∞—á–∞ 2** - –≤–∞–∂–Ω–æ (—É–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â—É—é –ª–æ–≥–∏–∫—É)
4. **–ó–∞–¥–∞—á–∞ 4** - –≤–∞–∂–Ω–æ (—É–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É)
5. **–ó–∞–¥–∞—á–∞ 5** - –≤–∞–∂–Ω–æ (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
6. **–ó–∞–¥–∞—á–∞ 6** - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
7. **–ó–∞–¥–∞—á–∞ 7** - –∫—Ä–∏—Ç–∏—á–Ω–æ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
8. **–ó–∞–¥–∞—á–∞ 8** - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (cleanup)
