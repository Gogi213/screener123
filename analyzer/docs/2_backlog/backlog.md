# Бэклог проекта Analyzer

Этот документ отслеживает технический долг, идеи по улучшению и новые функции для проекта `analyzer`. Обновлено: 2025-11-19

## Технический долг

| ID | Задача | Компонент | Приоритет | Статус | Описание |
|----|--------|-----------|----------|--------|----------|
| TD-001 | Вынести `ZERO_THRESHOLD` в конфигурацию | `analyze_pair_fast:224` | High | To Do | Константа `ZERO_THRESHOLD = 0.05` жестко закодирована. Должна быть параметром командной строки для гибкой настройки. |
| TD-002 | Улучшить обработку ошибок | `analyze_symbol_batch:15` | High | To Do | Блок `except Exception: pass` скрывает ошибки. Необходимо добавить детальное логирование ошибок в отдельный файл для диагностики. |
| TD-003 | Конфигурируемые пути вывода | `run_ultra_fast_analysis:298` | Medium | To Do | Директория `summary_stats` и формат имени файла `summary_stats_{timestamp}.csv` жестко закодированы. |
| TD-004 | Убрать "магические числа" | Весь скрипт | Medium | To Do | Числа `10` для топ-пар, `3` в множителе воркеров, `[0.3, 0.5, 0.4]` для порогов должны быть параметрами. |
| TD-005 | Исправить конверсию в numpy | `count_complete_cycles:224` | High | To Do | Функция использует `.to_numpy()` для итеративной обработки - критическое узкое место производительности. |
| TD-006 | Добавить валидацию дат | `run_ultra_fast_analysis:442` | Low | To Do | Базовая валидация формата дат есть, но нужна проверка логичности диапазонов. |

## Рефакторинг

| ID | Задача | Компонент | Приоритет | Статус | Описание |
|----|--------|-----------|----------|--------|----------|
| REF-001 | Модуляризация кода | Весь скрипт | High | **Done** | Код разбит на модули в `lib/`: `data_loader.py`, `analysis.py`, `config.py`, `discovery.py`. |

...

## Исправленные проблемы (Recent Fixes)

| ID | Проблема | Компонент | Дата исправления | Описание |
|----|---------|-----------|-----------------|----------|
| FIX-001 | Исправлена логика deviation | `analyze_pair_fast` | 2025-11-19 | Changed from mean-based к 1.0-based deviation для корректного арбитража. |
| FIX-002 | Исправлена детекция zero crossings | `analyze_pair_fast` | 2025-11-19 | Использование умножения вместо сложения для определения смены знака. |
| FIX-003 | Оптимизировано сканирование Parquet | `load_exchange_symbol_data` | 2025-11-19 | Единое `scan_parquet` вместо множественных сканирований (2-4x быстрее). |
| FIX-004 | Добавлена параллельная загрузка бирж | `analyze_symbol_batch` | 2025-11-19 | ThreadPoolExecutor для загрузки данных с разных бирж (1.5-2x быстрее). |
| FIX-005 | Исправлена нормализация символов | `data_loader.py`, `discovery.py` | 2025-11-19 | Согласован формат `SYMBOL_USDT` между Collections, Discovery и Analyzer. |
| FIX-006 | Удален мертвый код | `run_all_ultra_*.py` | 2025-11-19 | Удалены дубликаты скриптов (`_old`, `_v2`), оставлен только канонический `run_all_ultra.py`. |
| REF-002 | Декомпозиция `analyze_pair_fast` | `analyze_pair_fast:117` | High | To Do | Функция 300+ строк. Разбить на: синхронизацию, расчет метрик, подсчет циклов, детекцию паттернов. |
| REF-003 | Оптимизация IPC | `run_ultra_fast_analysis:298` | Medium | To Do | Передача больших DataFrame между процессами создает накладные расходы. Рассмотреть shared memory. |
| REF-004 | Улучшение архитектуры параллелизма | `analyze_symbol_batch:15` | Medium | To Do | Текущая архитектура: multiprocessing + threading. Пересмотреть с учетом реальных bottleneck'ов. |

## Тестирование

| ID | Задача | Компонент | Приоритет | Статус | Описание |
|----|--------|-----------|----------|--------|----------|
| TEST-001 | Unit-тесты для `count_complete_cycles` | `count_complete_cycles:224` | Critical | To Do | Написать тесты для ключевого алгоритма подсчета циклов с edge cases. |
| TEST-002 | Unit-тесты для синхронизации данных | `analyze_pair_fast:117` | High | To Do | Тесты для `join_asof` и обработки различных сценариев временных рядов. |
| TEST-003 | Integration-тест пайплайна | `run_ultra_fast_analysis:298` | High | To Do | Тест полного цикла на mock данных с проверкой CSV вывода. |
| TEST-004 | Тесты производительности | Весь скрипт | Medium | To Do | Бенчмарки для отслеживания деградации производительности при изменениях. |

## Новые функции и улучшения

| ID | Фича | Компонент | Приоритет | Статус | Описание |
|----|-------|-----------|----------|--------|----------|
| FEAT-001 | Полный анализ арбитражных путей | `analyze_pair_fast:117` | High | To Do | Сейчас только `bid1/bid2`. Добавить анализ всех 4 путей: `bid1/ask2`, `ask1/bid2` для полноты. |
| FEAT-002 | Учет комиссий бирж | `analyze_pair_fast:117` | High | To Do | Реалистичное моделирование с комиссиями и проскальзыванием для точных метрик возможностей. |
| FEAT-003 | Поддержка дополнительных форматов | `load_exchange_symbol_data:54` | Medium | To Do | Поддержка JSON, CSV помимо Parquet для гибкости источников данных. |
| FEAT-004 | HTML-отчеты с графиками | `run_ultra_fast_analysis:298` | Medium | To Do | Интерактивный отчет вместо CSV с графиками временных рядов для топ-10 пар. |
| FEAT-005 | Статистические тесты | `analyze_pair_fast:117` | Low | To Do | ADF-тест для стационарности, тест на нормальность распределения отклонений. |
| FEAT-006 | Конфигурационный файл | `run_ultra_fast_analysis:442` | Low | To Do | Поддержка YAML/JSON конфигов помимо argparse для сложных сценариев. |

## Архитектурные улучшения

| ID | Улучшение | Компонент | Приоритет | Статус | Описание |
|----|-----------|-----------|----------|--------|----------|
| ARCH-001 | Добавить кэширование результатов | `run_ultra_fast_analysis:298` | Medium | To Do | Кэш результатов анализа на диске для повторного использования. |
| ARCH-002 | Streaming обработка | `load_exchange_symbol_data:54` | Medium | To Do | Чанкенная обработка больших датасетов вместо загрузки целиком в память. |
| ARCH-003 | Мониторинг производительности | Весь скрипт | Low | To Do | Телеметрия: время выполнения, использование памяти, throughput. |

## Исправленные проблемы (Recent Fixes)

| ID | Проблема | Компонент | Дата исправления | Описание |
|----|---------|-----------|-----------------|----------|
| FIX-001 | Исправлена логика deviation | `analyze_pair_fast:155` | 2025-11-19 | Changed from mean-based к 1.0-based deviation для корректного арбитража. |
| FIX-002 | Исправлена детекция zero crossings | `analyze_pair_fast:172` | 2025-11-19 | Использование умножения вместо сложения для определения смены знака. |
| FIX-003 | Оптимизировано сканирование Parquet | `load_exchange_symbol_data:90` | 2025-11-19 | Единое `scan_parquet` вместо множественных сканирований (2-4x быстрее). |
| FIX-004 | Добавлена параллельная загрузка бирж | `analyze_symbol_batch:20` | 2025-11-19 | ThreadPoolExecutor для загрузки данных с разных бирж (1.5-2x быстрее). |

## Критические архитектурные проблемы

| ID | Проблема | Компонент | Срочность | Описание |
|----|----------|-----------|-----------|----------|
| CRIT-001 | NumPy конверсия в горячем цикле | `count_complete_cycles:224` | High | `.to_numpy()` создает копию данных и ломает zero-copy оптимизации Polars. |
| CRIT-002 | Отсутствие тестов | Весь проект | High | Нет тестирования критически важных алгоритмов - риск regression bugs. |
| CRIT-003 | Жестко закодированные параметры | Весь скрипт | Medium | Отсутствие конфигурируемости затрудняет адаптацию под разные рынки. |

## Статус выполнения

- **Высокий приоритет:** 7 задач To Do, 0 выполнено
- **Средний приоритет:** 8 задач To Do, 0 выполнено  
- **Низкий приоритет:** 6 задач To Do, 0 выполнено
- **Исправлено недавно:** 4 проблемы

**Общий прогресс:** 0% завершено (актуально на 2025-11-19)
